# QTrader-Viz

> Interactive visualization platform for QTrader backtesting results

## Overview

**QTrader-Viz** is a standalone web application for visualizing quantitative trading backtests generated by QTrader. Built with modern web technologies, it provides interactive charts, performance analytics, and detailed trade analysis.

## Features

- ðŸ“Š **Interactive Charts**: Price charts with signals, equity curves, drawdowns using TradingView Lightweight Charts
- ðŸ“ˆ **Performance Metrics**: Comprehensive analytics including Sharpe, Sortino, Calmar ratios, drawdowns, and more
- ðŸ”¥ **Monthly Returns Heatmap**: Visual representation of monthly performance
- ðŸ’¼ **Trade Analysis**: Detailed trade-by-trade breakdown with P&L tracking
- ðŸŽ¯ **Signal Visualization**: See entry/exit signals directly on price charts
- ðŸ“± **Responsive Design**: Works on desktop and mobile devices

## Tech Stack

- **Framework**: Vite + React 19 + TypeScript
- **Charts**: TradingView Lightweight Charts v5
- **Data Format**: JSON (QTrader exports)
- **Styling**: CSS
- **Package Manager**: pnpm

## Quick Start

### Prerequisites

- **Node.js 20+** (recommended: use [nvm](https://github.com/nvm-sh/nvm))
- **pnpm** - Fast, disk space efficient package manager

### Installation

```bash
# 1. Install pnpm (if not already installed)
npm install -g pnpm
# Or use: curl -fsSL https://get.pnpm.io/install.sh | sh -

# 2. Clone the repository
git clone <your-repo-url>
cd QTrader-Viz

# 3. Install dependencies
pnpm install

# 4. Start development server
pnpm dev
```

The app will open at `http://localhost:3000`

## Available Scripts

- `pnpm dev` - Start development server with hot reload
- `pnpm build` - Build for production
- `pnpm preview` - Preview production build locally
- `pnpm lint` - Run ESLint checks
- `pnpm typecheck` - Run TypeScript type checking
- `pnpm validate` - Run both typecheck and lint
- `pnpm format` - Format code with Prettier
- `pnpm test` - Run tests with Vitest
- `pnpm clean` - Clean all generated files and dependencies

## Data Setup

QTrader-Viz expects backtest data in the following structure:

```text
public/data/runs/
â””â”€â”€ YYYYMMDD_HHMMSS/          # Run directory
    â”œâ”€â”€ manifest.json          # Run metadata
    â”œâ”€â”€ metadata.json          # Backtest configuration
    â”œâ”€â”€ performance.json       # Performance metrics
    â””â”€â”€ timeseries/
        â”œâ”€â”€ chart_data.json    # OHLCV + signals + indicators
        â”œâ”€â”€ trades.json        # Individual trades
        â”œâ”€â”€ equity_curve.json  # Portfolio equity over time
        â”œâ”€â”€ drawdowns.json     # Drawdown periods
        â””â”€â”€ returns.json       # Period returns
```

### Linking Your Data

#### Option 1: Symbolic link (recommended)

```bash
# Create symlink to your latest QTrader run
ln -s /path/to/qtrader/exports/YYYYMMDD_HHMMSS public/data/runs/latest

# Or create a runs directory and link specific runs
mkdir -p public/data/runs
ln -s /path/to/qtrader/exports/20250107_144852 public/data/runs/20250107_144852
```

#### Option 2: Copy data

```bash
# Copy run directory to public/data/runs/
cp -r /path/to/qtrader/exports/YYYYMMDD_HHMMSS public/data/runs/
```

Then update the `RUN_PATH` in [src/hooks/useBacktestData.ts](src/hooks/useBacktestData.ts) to point to your run:

```typescript
const RUN_PATH = '/data/runs/latest'; // or '/data/runs/YYYYMMDD_HHMMSS'
```

### Getting Data from QTrader

1. Run a backtest in QTrader with JSON export enabled:

   ```yaml
   reporting:
     write_json: true
     include_equity_curve: true
     include_trades: true
     include_drawdowns: true
     include_returns: true
   ```

2. Find the exported run in your QTrader output directory (typically `exports/YYYYMMDD_HHMMSS`)

3. Link or copy the data to QTrader-Viz (see above)

## Usage

### Tab Navigation

- **Overview**: Performance metrics, price chart, equity curve, monthly returns heatmap
- **Trades**: All trades table with summary statistics
- **Drawdowns**: Top 10 drawdown periods

### Customization

Modify `RUN_PATH` in [src/hooks/useBacktestData.ts](src/hooks/useBacktestData.ts) to switch between different backtest runs:

```typescript
const RUN_PATH = '/data/runs/latest'; // Change this to your run directory
```

## Development Workflow

```bash
# Start dev server (with hot reload)
pnpm dev

# Run linting
pnpm lint

# Run type checking
pnpm typecheck

# Run validation (typecheck + lint)
pnpm validate

# Format code
pnpm format

# Build for production
pnpm build

# Preview production build
pnpm preview
```

### Building for Production

```bash
# Build optimized production bundle
pnpm build

# Preview the production build locally
pnpm preview
```

The production build will be in the `dist/` directory. You can serve this directory with any static file server.

## Troubleshooting

### Port already in use

If port 3000 is already in use, Vite will automatically try the next available port.

### No data displayed

- Ensure your run directory is in `public/data/runs/`
- Verify all required JSON files exist (see Data Setup section)
- Check browser console for errors

### Charts not rendering

- Check browser console for errors
- Ensure chart data has valid timestamps in ascending order
- Verify OHLCV data is properly formatted

## Architecture

### Core Files

- **src/App.tsx**: Main application with tab navigation
- **src/hooks/useBacktestData.ts**: Data loading hook
- **src/lib/loaders/backtestLoader.ts**: JSON data loaders
- **src/lib/processors/dataProcessor.ts**: Data processing and transformation
- **src/lib/types/qtrader.ts**: TypeScript type definitions

### Components

```text
src/components/
â”œâ”€â”€ tabs/
â”‚   â”œâ”€â”€ OverviewTab.tsx      # Performance metrics, charts, heatmap
â”‚   â”œâ”€â”€ TradesTab.tsx         # Trades table and summary
â”‚   â””â”€â”€ RiskTab.tsx           # Drawdowns analysis
â”œâ”€â”€ EquityChart.tsx           # Equity curve visualization
â”œâ”€â”€ PriceChart.tsx            # Price chart with signals
â”œâ”€â”€ MonthlyReturnsHeatmap.tsx # Monthly returns calendar
â”œâ”€â”€ TabNavigation.tsx         # Tab navigation component
â””â”€â”€ TradesTable.tsx           # Trades table component
```

## Contributing

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Make your changes
4. Run validation (`pnpm validate`)
5. Format code (`pnpm format`)
6. Commit your changes (`git commit -m 'feat: add amazing feature'`)
7. Push to the branch (`git push origin feature/amazing-feature`)
8. Open a Pull Request

## License

This project is licensed under the MIT License.

## Acknowledgments

- [TradingView Lightweight Charts](https://tradingview.github.io/lightweight-charts/) for charting library
- [QTrader](https://github.com/your-org/qtrader) for backtesting framework
